<!DOCTYPE html>
<html>

<head>
  <script src="https://cdn.jsdelivr.net/npm/vega@5.22.1"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.5.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.21.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
    crossorigin="anonymous"></script>

  <!-- CSS file -->
  <link rel="stylesheet" type="text/css" href="css/styles.css" media="all">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

</head>

<body>
  <div class="main text-center">
    <h2>Mental Health Disorders and Depression Data Statistics</h2>

    <div class="row">
      <div class="col">
        <hr>
        <Strong>Select Category Below</Strong>
        <hr>
        <div class="form-check">
          <input class="form-check-input" type="radio" name="categoryRadio" id="Schizophrenia (%)" checked>
          <label class="form-check-label" for="flexRadioDefault1">
            Schizophrenia
          </label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="radio" name="categoryRadio" id="Bipolar disorder (%)">
          <label class="form-check-label" for="flexRadioDefault2">
            Bipolar disorder
          </label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="radio" name="categoryRadio" id="Eating disorders (%)">
          <label class="form-check-label" for="flexRadioDefault2">
            Eating disorders
          </label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="radio" name="categoryRadio" id="Anxiety disorders (%)">
          <label class="form-check-label" for="flexRadioDefault2">
            Anxiety disorders
          </label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="radio" name="categoryRadio" id="Drug use disorders (%)">
          <label class="form-check-label" for="flexRadioDefault2">
            Drug use disorders
          </label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="radio" name="categoryRadio" id="Depression (%)">
          <label class="form-check-label" for="flexRadioDefault2">
            Depression
          </label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="radio" name="categoryRadio" id="Alcohol use disorders (%)">
          <label class="form-check-label" for="flexRadioDefault2">
            Alcohol use disorders
          </label>
        </div>
        <hr>
      </div>
      <div class="col-8" id="choropleth_map">
      </div>
      <div class="col">
        <div class="dropdown">
          <button class="btn btn-secondary dropdown-toggle" type="button" id="yearDropdown" data-bs-toggle="dropdown"
            aria-expanded="false">
            Choose Year
          </button>

          <ul class="dropdown-menu" aria-labelledby="yearDropdown">
            <li><a class="dropdown-item" href="#" data-year="2007">2007</a></li>
            <li><a class="dropdown-item" href="#" data-year="2008">2008</a></li>
            <li><a class="dropdown-item" href="#" data-year="2009">2009</a></li>
            <li><a class="dropdown-item" href="#" data-year="2010">2010</a></li>
            <li><a class="dropdown-item" href="#" data-year="2011">2011</a></li>
            <li><a class="dropdown-item" href="#" data-year="2012">2012</a></li>
            <li><a class="dropdown-item" href="#" data-year="2013">2013</a></li>
            <li><a class="dropdown-item" href="#" data-year="2014">2014</a></li>
            <li><a class="dropdown-item" href="#" data-year="2015">2015</a></li>
            <li><a class="dropdown-item" href="#" data-year="2016">2016</a></li>
            <li><a class="dropdown-item" href="#" data-year="2017">2017</a></li>
          </ul>
        </div>
      </div>
    </div>

  </div>



  <div id="choropleth_map"></div>

  <script type="text/javascript">

    var spec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "title": "Statistics on the Number of Patients with Different Types of Mental Health Disorders",
      "width": 800,
      "height": 400,
      "projection": { "type": "equirectangular" },
      "data": {
        "url": "https://raw.githubusercontent.com/JasonWu7/w9/main/data/ne_110m_countries.topojson",
        "format": { "type": "topojson", "feature": "ne_110m_admin_0_countries" }
      },
      "layer": [
        {
          "transform": [
            {
              "calculate": "'Data is not available in ' + datum.properties.NAME",
              "as": "note"
            }
          ],
          "mark": { "type": "geoshape", "fill": "lightgray", "stroke": "white" },
          "encoding": { "tooltip": { "field": "note" } }
        },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/JasonWu7/w9/main/data/combined_dataset_1_2.csv",
          },
          "transform": [
            {
              "lookup": "Code",
              "from": {
                "data": {
                  "url": "https://raw.githubusercontent.com/JasonWu7/w9/main/data/ne_110m_countries.topojson",
                  "format": { "type": "topojson", "feature": "ne_110m_admin_0_countries" }
                },
                "key": "properties.ISO_A3_EH",
              },
              "as": "geo"
            },
            { "filter": { "field": "Year", "equal": "2017" } },
            {
              "calculate": "datum['Schizophrenia (%)'] * datum['Population'] / 10000",
              "as": "num_patient_per_10k"
            }
          ],
          "mark": { "type": "geoshape", "stroke": "white" },
          "encoding": {
            "shape": { "field": "geo", "type": "geojson" },
            "color": {
              "field": "num_patient_per_10k",
              "type": "quantitative",
              "scale": {  "type": "log",
            "domain": [1, 10, 100, 1000, 10000, 100000], },
              "legend": { "title": "Number of patients per 10,000 population", "titleLimit": "250" }
            },
            "tooltip": [
              { "field": "Entity", "type": "nominal", "title": "Country" },
              { "field": "num_patient_per_10k", "type": "quantitative", "format": ".2f", "title": "Number of patients per 10,000 population" }
            ],
          },
        },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/7_others/oceans.topojson",
            "format": { "type": "topojson", "feature": "oceans" }
          },
          "mark": { "type": "geoshape", "fill": "skyblue" }
        },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/JasonWu7/w9/main/data/ne_110m_countries.topojson",
            "format": { "type": "topojson", "feature": "ne_110m_graticules_30" }
          },
          "mark": { "type": "geoshape", "fill": null, "stroke": "white" },
        }
      ],
    };

    var selectedYear = "2017"; // Set the initial year

    function setChartTitle(category, year) {
      var categoryNameWithoutUnit = category.replace(" (%)", "");
      spec.title = `Statistics on the Number of Patients with ${categoryNameWithoutUnit} (Year: ${year})`;
    }

    function updateMap(year) {
      spec.layer[1].transform[1].filter.equal = year.toString();
      setChartTitle(document.querySelector('input[name="categoryRadio"]:checked').id, year);

      vegaEmbed('#choropleth_map', spec).then(function (result) {
      }).catch(console.error);
    }

    // Add event listeners to the dropdown menu items
    document.querySelectorAll('.dropdown-item').forEach(function (item) {
      item.addEventListener('click', function () {
        selectedYear = item.getAttribute('data-year');
        updateMap(selectedYear);
      });
    });

    function updateMapCategory(category) {
      // Update the spec to use the selected category field
      spec.layer[1].transform[2].calculate = `datum['${category}'] * datum['Population'] / 10000`;
      setChartTitle(category, selectedYear);

      // Embed the updated spec into the #choropleth_map element
      vegaEmbed('#choropleth_map', spec).then(function (result) {
      }).catch(console.error);
    }

    // Add event listeners to the radio buttons
    document.querySelectorAll('input[name="categoryRadio"]').forEach(function (radio) {
      radio.addEventListener('change', function () {
        var selectedCategory = radio.id; // Get the ID of the selected radio button
        updateMapCategory(selectedCategory);
      });
    });

    // Initial map rendering
    updateMap(selectedYear);
    updateMapCategory("Schizophrenia (%)");
  </script>

</body>

</html>